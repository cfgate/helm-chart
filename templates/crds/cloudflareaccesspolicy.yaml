{{- if .Values.installCRDs }}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.20.0
    helm.sh/resource-policy: keep
  name: cloudflareaccesspolicies.cfgate.io
  labels:
    {{- include "cfgate.labels" . | nindent 4 }}
spec:
  group: cfgate.io
  names:
    kind: CloudflareAccessPolicy
    listKind: CloudflareAccessPolicyList
    plural: cloudflareaccesspolicies
    shortNames:
    - cfap
    - cfaccess
    singular: cloudflareaccesspolicy
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .status.conditions[?(@.type=='Ready')].status
      name: Ready
      type: string
    - jsonPath: .status.applicationId
      name: Application
      type: string
    - jsonPath: .status.attachedTargets
      name: Targets
      type: integer
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: |-
          CloudflareAccessPolicy is the Schema for the cloudflareaccesspolicies API.

          CloudflareAccessPolicy manages Cloudflare Access Applications and Policies for zero-trust
          access control. It attaches to Gateway API resources (Gateway, HTTPRoute, GRPCRoute,
          TCPRoute, UDPRoute) using the targetRefs pattern and creates corresponding Access
          Applications in Cloudflare.

          Access rules are organized into implementation tiers based on IdP requirements:
            - P0: IP, IPList, Country, Everyone, ServiceToken, AnyValidServiceToken (no IdP)
            - P1: Email, EmailList, EmailDomain, OIDCClaim (basic IdP required)
            - P2: GSuiteGroup (Google Workspace required)
            - P3: deferred to v0.2.0 (Certificate, CommonName, Group, GitHub, Azure, Okta, SAML, etc.)

          Status conditions:
            - Ready: policy is fully applied to all targets
            - CredentialsValid: Cloudflare credentials have been validated
            - TargetsResolved: all targetRefs have been found and validated
            - ReferenceGrantValid: cross-namespace references are authorized
            - ApplicationCreated: Access Application exists in Cloudflare
            - PoliciesAttached: Access policies are attached to the application
            - ServiceTokensReady: all service tokens have been created
            - MTLSConfigured: mTLS rule is configured (if enabled)
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: |-
              CloudflareAccessPolicySpec defines the desired state of a CloudflareAccessPolicy resource.

              CloudflareAccessPolicySpec configures Cloudflare Access protection for Gateway API resources.
              It specifies which resources to protect (via targetRef/targetRefs), the Access Application
              settings, and the access policies that control who can access the protected hostnames.
            properties:
              application:
                description: Application defines the Access Application settings.
                properties:
                  allowedIdps:
                    description: |-
                      AllowedIdps restricts which identity providers can authenticate.
                      Values are Cloudflare Identity Provider UUIDs.
                      When empty, all IdPs configured in the account are allowed.
                    items:
                      type: string
                    maxItems: 25
                    type: array
                  appLauncherVisible:
                    default: true
                    description: |-
                      AppLauncherVisible controls whether the application appears in the
                      Cloudflare App Launcher dashboard. Use pointer to distinguish
                      explicit false (hidden) from absent (default visible).
                    type: boolean
                  autoRedirectToIdentity:
                    description: |-
                      AutoRedirectToIdentity auto-redirects to the identity provider
                      when a single IdP is configured in allowedIdps. Skips the IdP
                      selection page.
                    type: boolean
                  corsHeaders:
                    description: |-
                      CORSHeaders configures CORS for browser-based APIs behind Access.
                      When set, Cloudflare responds to OPTIONS preflight on behalf of the origin.
                      Mutually exclusive with optionsPreflightBypass.
                    properties:
                      allowAllHeaders:
                        description: AllowAllHeaders allows all HTTP request headers.
                        type: boolean
                      allowAllMethods:
                        description: AllowAllMethods allows all HTTP request methods.
                        type: boolean
                      allowAllOrigins:
                        description: AllowAllOrigins allows all origins.
                        type: boolean
                      allowCredentials:
                        description: |-
                          AllowCredentials includes credentials (cookies, authorization headers,
                          or TLS client certificates) with CORS requests.
                        type: boolean
                      allowedHeaders:
                        description: |-
                          AllowedHeaders lists specific allowed HTTP request headers.
                          Ignored when allowAllHeaders is true.
                        items:
                          type: string
                        maxItems: 50
                        type: array
                      allowedMethods:
                        description: |-
                          AllowedMethods lists specific allowed HTTP request methods.
                          Ignored when allowAllMethods is true.
                        items:
                          description: CORSAllowedMethod is an HTTP method allowed
                            for CORS requests.
                          enum:
                          - GET
                          - POST
                          - HEAD
                          - PUT
                          - DELETE
                          - CONNECT
                          - OPTIONS
                          - TRACE
                          - PATCH
                          type: string
                        maxItems: 9
                        type: array
                      allowedOrigins:
                        description: |-
                          AllowedOrigins lists specific allowed origins.
                          Ignored when allowAllOrigins is true.
                        items:
                          type: string
                        maxItems: 50
                        type: array
                      maxAge:
                        description: MaxAge is the maximum number of seconds preflight
                          results can be cached.
                        maximum: 86400
                        minimum: 0
                        type: integer
                    type: object
                  customDenyMessage:
                    description: CustomDenyMessage shown when access is denied.
                    maxLength: 1024
                    type: string
                  customDenyUrl:
                    description: CustomDenyURL redirects to this URL when denied (instead
                      of message).
                    type: string
                  customNonIdentityDenyUrl:
                    description: |-
                      CustomNonIdentityDenyURL is the URL users are redirected to when
                      denied by a non-identity (service auth) policy. Separate from
                      customDenyUrl which handles identity-based denials.
                    maxLength: 1024
                    type: string
                  domain:
                    description: |-
                      Domain is the protected domain (auto-generated from routes if omitted).
                      Max 253: RFC 1035 section 2.3.4 FQDN presentation-format limit.
                    maxLength: 253
                    type: string
                    x-kubernetes-validations:
                    - message: each DNS label must not exceed 63 octets (RFC 1035
                        section 2.3.4)
                      rule: self == '' || self.split('.').all(s, size(s) <= 63)
                  enableBindingCookie:
                    default: false
                    description: EnableBindingCookie enables binding cookies for sticky
                      sessions.
                    type: boolean
                  httpOnlyCookieAttribute:
                    default: true
                    description: HttpOnlyCookieAttribute adds HttpOnly to session
                      cookies.
                    type: boolean
                  logoUrl:
                    description: LogoURL is the application logo in dashboard.
                    maxLength: 1024
                    type: string
                  name:
                    description: |-
                      Name is the display name in Cloudflare dashboard.
                      Defaults to CR name if omitted.
                    maxLength: 255
                    type: string
                  optionsPreflightBypass:
                    description: |-
                      OptionsPreflightBypass allows OPTIONS preflight requests to bypass
                      Access authentication and go directly to the origin. Enabling this
                      removes all CORS header settings. Mutually exclusive with corsHeaders.
                    type: boolean
                  path:
                    default: /
                    description: Path restricts protection to specific path prefix.
                    maxLength: 1024
                    type: string
                  pathCookieAttribute:
                    description: |-
                      PathCookieAttribute scopes the Access JWT cookie to the application
                      path instead of the hostname. When enabled, users must re-authenticate
                      for different paths on the same hostname.
                    type: boolean
                  readServiceTokensFromHeader:
                    description: |-
                      ReadServiceTokensFromHeader enables reading service tokens from a
                      single custom HTTP header instead of the standard CF-Access-Client-Id
                      and CF-Access-Client-Secret header pair. The value is the header name.
                      The header value must contain a JSON object with "cf-access-client-id"
                      and "cf-access-client-secret" keys.
                    maxLength: 256
                    type: string
                  sameSiteCookieAttribute:
                    default: lax
                    description: SameSiteCookieAttribute controls cross-site cookie
                      behavior.
                    enum:
                    - strict
                    - lax
                    - none
                    type: string
                  serviceAuth401Redirect:
                    description: |-
                      ServiceAuth401Redirect returns a 401 status code instead of
                      redirecting to the Access login page when a request is blocked by a
                      Service Auth (non_identity) policy. Enable for API consumers.
                    type: boolean
                  sessionDuration:
                    default: 24h
                    description: SessionDuration controls session cookie lifetime.
                    pattern: ^[0-9]+(h|m|s)$
                    type: string
                  skipInterstitial:
                    default: false
                    description: SkipInterstitial bypasses the Access login page for
                      API requests.
                    type: boolean
                  type:
                    default: self_hosted
                    description: Type is the application type.
                    enum:
                    - self_hosted
                    - saas
                    - ssh
                    - vnc
                    - browser_isolation
                    type: string
                type: object
                x-kubernetes-validations:
                - message: corsHeaders and optionsPreflightBypass are mutually exclusive
                  rule: '!(has(self.corsHeaders) && has(self.optionsPreflightBypass)
                    && self.optionsPreflightBypass)'
              cloudflareRef:
                description: CloudflareRef references Cloudflare credentials (inherits
                  from tunnel if omitted).
                properties:
                  accountId:
                    description: AccountID is the Cloudflare account ID.
                    maxLength: 32
                    type: string
                  accountName:
                    description: AccountName is the Cloudflare account name (looked
                      up via API).
                    maxLength: 255
                    type: string
                  name:
                    description: Name of the secret containing credentials.
                    maxLength: 253
                    minLength: 1
                    type: string
                  namespace:
                    description: Namespace of the secret (defaults to policy namespace).
                    type: string
                required:
                - name
                type: object
              groupRefs:
                description: GroupRefs reference reusable identity rules.
                items:
                  description: |-
                    AccessGroupRef references a Cloudflare Access Group.

                    AccessGroupRef enables referencing reusable identity rules defined as Access Groups
                    in Cloudflare. Groups can be referenced by Kubernetes CR name (future feature) or
                    by Cloudflare ID.
                  properties:
                    cloudflareId:
                      description: CloudflareID of group in Cloudflare (bypasses CR
                        lookup).
                      maxLength: 36
                      type: string
                    name:
                      description: Name of AccessGroup CR in same namespace.
                      maxLength: 253
                      type: string
                  type: object
                  x-kubernetes-validations:
                  - message: either name or cloudflareId must be specified
                    rule: has(self.name) || has(self.cloudflareId)
                maxItems: 50
                type: array
              mtls:
                description: MTLS configures certificate-based authentication.
                properties:
                  associatedHostnames:
                    description: AssociatedHostnames limits mTLS to specific hostnames.
                    items:
                      type: string
                    maxItems: 25
                    type: array
                  enabled:
                    default: false
                    description: Enabled activates mTLS requirement.
                    type: boolean
                  rootCaSecretRef:
                    description: RootCASecretRef references the CA certificate(s)
                      for validation.
                    properties:
                      key:
                        default: ca.crt
                        description: Key within Secret (defaults to ca.crt).
                        maxLength: 253
                        type: string
                      name:
                        description: Name of the Secret.
                        maxLength: 253
                        minLength: 1
                        type: string
                    required:
                    - name
                    type: object
                  ruleName:
                    description: |-
                      RuleName is the name of the mTLS rule in Cloudflare.
                      Defaults to CR name if omitted.
                    maxLength: 255
                    type: string
                required:
                - enabled
                type: object
              policies:
                description: Policies define access rules (evaluated in order).
                items:
                  description: |-
                    AccessPolicyRule defines an access allow, deny, bypass, or non_identity rule.

                    AccessPolicyRule specifies who can access the protected application. Rules are evaluated
                    in precedence order (lower precedence = higher priority). Each rule contains Include
                    (ANY must match), Exclude (if ANY match, rule does not apply), and Require (ALL must match)
                    conditions.
                  properties:
                    approvalGroups:
                      description: ApprovalGroups defines who can approve access.
                      items:
                        description: |-
                          ApprovalGroup defines who can approve access requests for approval-required policies.

                          ApprovalGroup specifies approvers by email address or email domain. When a policy
                          requires approval, users matching this group can approve or deny access requests.
                        properties:
                          approvalsNeeded:
                            default: 1
                            description: ApprovalsNeeded is number of approvals required.
                            minimum: 1
                            type: integer
                          emailDomain:
                            description: |-
                              EmailDomain allows any user from domain to approve.
                              Max 253: RFC 1035 section 2.3.4 FQDN presentation-format limit.
                            maxLength: 253
                            type: string
                          emails:
                            description: Emails of approvers.
                            items:
                              type: string
                            maxItems: 50
                            type: array
                        type: object
                        x-kubernetes-validations:
                        - message: at least one approver (emails or emailDomain) must
                            be specified
                          rule: size(self.emails) > 0 || has(self.emailDomain)
                      maxItems: 10
                      type: array
                    approvalRequired:
                      default: false
                      description: ApprovalRequired requires approval from specific
                        users.
                      type: boolean
                    decision:
                      default: allow
                      description: Decision is the policy action.
                      enum:
                      - allow
                      - deny
                      - bypass
                      - non_identity
                      type: string
                    exclude:
                      description: Exclude rules (if ANY match, rule does not apply).
                      items:
                        description: |-
                          AccessRule defines identity matching criteria for Access policies.

                          AccessRule specifies conditions that identify users or services. Rules are organized
                          into implementation tiers based on IdP requirements:
                            - P0 (no IdP): IP, IPList, Country, Everyone, ServiceToken, AnyValidServiceToken
                            - P1 (basic IdP): Email, EmailList, EmailDomain, OIDCClaim
                            - P2 (Google Workspace): GSuiteGroup
                            - P3 (deferred to v0.2.0): Certificate, CommonName, Group, GitHub, Azure, Okta, SAML, etc.

                          SDK types map directly to cloudflare-go v6.6.0: IPRule, IPListRule, CountryRule,
                          EveryoneRule, ServiceTokenRule, AnyValidServiceTokenRule, EmailRule, DomainRule,
                          EmailListRule, AccessOIDCClaimRule, GSuiteGroupRule.
                        properties:
                          anyValidServiceToken:
                            description: |-
                              AnyValidServiceToken matches any valid service token.
                              SDK: AnyValidServiceTokenRule
                            type: boolean
                          country:
                            description: |-
                              Country matches source country codes (ISO 3166-1 alpha-2).
                              SDK: CountryRule
                            properties:
                              codes:
                                description: Codes are ISO 3166-1 alpha-2 country
                                  codes.
                                items:
                                  type: string
                                maxItems: 50
                                minItems: 1
                                type: array
                            required:
                            - codes
                            type: object
                          email:
                            description: |-
                              Email matches specific email addresses.
                              SDK: EmailRule
                            properties:
                              addresses:
                                description: Addresses to match.
                                items:
                                  type: string
                                maxItems: 50
                                minItems: 1
                                type: array
                            required:
                            - addresses
                            type: object
                          emailDomain:
                            description: |-
                              EmailDomain matches email domain suffix.
                              SDK: DomainRule
                            properties:
                              domain:
                                description: |-
                                  Domain suffix (e.g., "example.com").
                                  Max 253: RFC 1035 section 2.3.4 FQDN presentation-format limit.
                                maxLength: 253
                                minLength: 1
                                type: string
                            required:
                            - domain
                            type: object
                          emailList:
                            description: |-
                              EmailList references a Cloudflare Access email list.
                              SDK: EmailListRule
                            properties:
                              id:
                                description: ID of the Access list in Cloudflare.
                                maxLength: 36
                                type: string
                              name:
                                description: Name of the Access list (looked up via
                                  API).
                                maxLength: 255
                                type: string
                            type: object
                            x-kubernetes-validations:
                            - message: either id or name must be specified
                              rule: has(self.id) || has(self.name)
                          everyone:
                            description: |-
                              Everyone matches all users (use with caution).
                              SDK: EveryoneRule
                            type: boolean
                          gsuiteGroup:
                            description: |-
                              GSuiteGroup matches Google Workspace groups.
                              SDK: GSuiteGroupRule
                            properties:
                              email:
                                description: Email is the Google Workspace group email.
                                maxLength: 320
                                minLength: 1
                                type: string
                              identityProviderId:
                                description: IdentityProviderID in Cloudflare.
                                maxLength: 36
                                minLength: 1
                                type: string
                            required:
                            - email
                            - identityProviderId
                            type: object
                          ip:
                            description: |-
                              IP matches source IP CIDR ranges.
                              SDK: IPRule
                            properties:
                              ranges:
                                description: Ranges are CIDR blocks (IPv4 or IPv6).
                                items:
                                  type: string
                                maxItems: 50
                                minItems: 1
                                type: array
                            required:
                            - ranges
                            type: object
                          ipList:
                            description: |-
                              IPList references a Cloudflare IP List.
                              SDK: IPListRule
                            properties:
                              id:
                                description: ID of the IP list in Cloudflare.
                                maxLength: 36
                                type: string
                              name:
                                description: Name of the IP list (looked up via API).
                                maxLength: 255
                                type: string
                            type: object
                            x-kubernetes-validations:
                            - message: either id or name must be specified
                              rule: has(self.id) || has(self.name)
                          oidcClaim:
                            description: |-
                              OIDCClaim matches OIDC token claims.
                              SDK: AccessOIDCClaimRule
                            properties:
                              claimName:
                                description: ClaimName is the OIDC claim to match.
                                maxLength: 255
                                minLength: 1
                                type: string
                              claimValue:
                                description: ClaimValue is the expected value.
                                maxLength: 255
                                minLength: 1
                                type: string
                              identityProviderId:
                                description: IdentityProviderID in Cloudflare.
                                maxLength: 36
                                minLength: 1
                                type: string
                            required:
                            - claimName
                            - claimValue
                            - identityProviderId
                            type: object
                          serviceToken:
                            description: |-
                              ServiceToken matches a specific service token by ID.
                              SDK: ServiceTokenRule
                            properties:
                              tokenId:
                                description: TokenID is the Cloudflare service token
                                  ID.
                                maxLength: 36
                                minLength: 1
                                type: string
                            required:
                            - tokenId
                            type: object
                        type: object
                        x-kubernetes-validations:
                        - message: at least one rule type must be specified
                          rule: '[has(self.ip), has(self.ipList), has(self.country),
                            has(self.everyone), has(self.serviceToken), has(self.anyValidServiceToken),
                            has(self.email), has(self.emailList), has(self.emailDomain),
                            has(self.oidcClaim), has(self.gsuiteGroup)].exists(x,
                            x)'
                      maxItems: 25
                      type: array
                    include:
                      description: Include rules (ANY must match for rule to apply).
                      items:
                        description: |-
                          AccessRule defines identity matching criteria for Access policies.

                          AccessRule specifies conditions that identify users or services. Rules are organized
                          into implementation tiers based on IdP requirements:
                            - P0 (no IdP): IP, IPList, Country, Everyone, ServiceToken, AnyValidServiceToken
                            - P1 (basic IdP): Email, EmailList, EmailDomain, OIDCClaim
                            - P2 (Google Workspace): GSuiteGroup
                            - P3 (deferred to v0.2.0): Certificate, CommonName, Group, GitHub, Azure, Okta, SAML, etc.

                          SDK types map directly to cloudflare-go v6.6.0: IPRule, IPListRule, CountryRule,
                          EveryoneRule, ServiceTokenRule, AnyValidServiceTokenRule, EmailRule, DomainRule,
                          EmailListRule, AccessOIDCClaimRule, GSuiteGroupRule.
                        properties:
                          anyValidServiceToken:
                            description: |-
                              AnyValidServiceToken matches any valid service token.
                              SDK: AnyValidServiceTokenRule
                            type: boolean
                          country:
                            description: |-
                              Country matches source country codes (ISO 3166-1 alpha-2).
                              SDK: CountryRule
                            properties:
                              codes:
                                description: Codes are ISO 3166-1 alpha-2 country
                                  codes.
                                items:
                                  type: string
                                maxItems: 50
                                minItems: 1
                                type: array
                            required:
                            - codes
                            type: object
                          email:
                            description: |-
                              Email matches specific email addresses.
                              SDK: EmailRule
                            properties:
                              addresses:
                                description: Addresses to match.
                                items:
                                  type: string
                                maxItems: 50
                                minItems: 1
                                type: array
                            required:
                            - addresses
                            type: object
                          emailDomain:
                            description: |-
                              EmailDomain matches email domain suffix.
                              SDK: DomainRule
                            properties:
                              domain:
                                description: |-
                                  Domain suffix (e.g., "example.com").
                                  Max 253: RFC 1035 section 2.3.4 FQDN presentation-format limit.
                                maxLength: 253
                                minLength: 1
                                type: string
                            required:
                            - domain
                            type: object
                          emailList:
                            description: |-
                              EmailList references a Cloudflare Access email list.
                              SDK: EmailListRule
                            properties:
                              id:
                                description: ID of the Access list in Cloudflare.
                                maxLength: 36
                                type: string
                              name:
                                description: Name of the Access list (looked up via
                                  API).
                                maxLength: 255
                                type: string
                            type: object
                            x-kubernetes-validations:
                            - message: either id or name must be specified
                              rule: has(self.id) || has(self.name)
                          everyone:
                            description: |-
                              Everyone matches all users (use with caution).
                              SDK: EveryoneRule
                            type: boolean
                          gsuiteGroup:
                            description: |-
                              GSuiteGroup matches Google Workspace groups.
                              SDK: GSuiteGroupRule
                            properties:
                              email:
                                description: Email is the Google Workspace group email.
                                maxLength: 320
                                minLength: 1
                                type: string
                              identityProviderId:
                                description: IdentityProviderID in Cloudflare.
                                maxLength: 36
                                minLength: 1
                                type: string
                            required:
                            - email
                            - identityProviderId
                            type: object
                          ip:
                            description: |-
                              IP matches source IP CIDR ranges.
                              SDK: IPRule
                            properties:
                              ranges:
                                description: Ranges are CIDR blocks (IPv4 or IPv6).
                                items:
                                  type: string
                                maxItems: 50
                                minItems: 1
                                type: array
                            required:
                            - ranges
                            type: object
                          ipList:
                            description: |-
                              IPList references a Cloudflare IP List.
                              SDK: IPListRule
                            properties:
                              id:
                                description: ID of the IP list in Cloudflare.
                                maxLength: 36
                                type: string
                              name:
                                description: Name of the IP list (looked up via API).
                                maxLength: 255
                                type: string
                            type: object
                            x-kubernetes-validations:
                            - message: either id or name must be specified
                              rule: has(self.id) || has(self.name)
                          oidcClaim:
                            description: |-
                              OIDCClaim matches OIDC token claims.
                              SDK: AccessOIDCClaimRule
                            properties:
                              claimName:
                                description: ClaimName is the OIDC claim to match.
                                maxLength: 255
                                minLength: 1
                                type: string
                              claimValue:
                                description: ClaimValue is the expected value.
                                maxLength: 255
                                minLength: 1
                                type: string
                              identityProviderId:
                                description: IdentityProviderID in Cloudflare.
                                maxLength: 36
                                minLength: 1
                                type: string
                            required:
                            - claimName
                            - claimValue
                            - identityProviderId
                            type: object
                          serviceToken:
                            description: |-
                              ServiceToken matches a specific service token by ID.
                              SDK: ServiceTokenRule
                            properties:
                              tokenId:
                                description: TokenID is the Cloudflare service token
                                  ID.
                                maxLength: 36
                                minLength: 1
                                type: string
                            required:
                            - tokenId
                            type: object
                        type: object
                        x-kubernetes-validations:
                        - message: at least one rule type must be specified
                          rule: '[has(self.ip), has(self.ipList), has(self.country),
                            has(self.everyone), has(self.serviceToken), has(self.anyValidServiceToken),
                            has(self.email), has(self.emailList), has(self.emailDomain),
                            has(self.oidcClaim), has(self.gsuiteGroup)].exists(x,
                            x)'
                      maxItems: 25
                      type: array
                    name:
                      description: Name is a human-readable identifier.
                      maxLength: 255
                      minLength: 1
                      type: string
                    precedence:
                      description: Precedence determines rule evaluation order (lower
                        = first).
                      maximum: 9999
                      minimum: 1
                      type: integer
                    purposeJustificationPrompt:
                      description: PurposeJustificationPrompt is the prompt shown
                        to user.
                      maxLength: 1024
                      type: string
                    purposeJustificationRequired:
                      default: false
                      description: PurposeJustificationRequired requires user to provide
                        justification.
                      type: boolean
                    require:
                      description: Require rules (ALL must match for rule to apply).
                      items:
                        description: |-
                          AccessRule defines identity matching criteria for Access policies.

                          AccessRule specifies conditions that identify users or services. Rules are organized
                          into implementation tiers based on IdP requirements:
                            - P0 (no IdP): IP, IPList, Country, Everyone, ServiceToken, AnyValidServiceToken
                            - P1 (basic IdP): Email, EmailList, EmailDomain, OIDCClaim
                            - P2 (Google Workspace): GSuiteGroup
                            - P3 (deferred to v0.2.0): Certificate, CommonName, Group, GitHub, Azure, Okta, SAML, etc.

                          SDK types map directly to cloudflare-go v6.6.0: IPRule, IPListRule, CountryRule,
                          EveryoneRule, ServiceTokenRule, AnyValidServiceTokenRule, EmailRule, DomainRule,
                          EmailListRule, AccessOIDCClaimRule, GSuiteGroupRule.
                        properties:
                          anyValidServiceToken:
                            description: |-
                              AnyValidServiceToken matches any valid service token.
                              SDK: AnyValidServiceTokenRule
                            type: boolean
                          country:
                            description: |-
                              Country matches source country codes (ISO 3166-1 alpha-2).
                              SDK: CountryRule
                            properties:
                              codes:
                                description: Codes are ISO 3166-1 alpha-2 country
                                  codes.
                                items:
                                  type: string
                                maxItems: 50
                                minItems: 1
                                type: array
                            required:
                            - codes
                            type: object
                          email:
                            description: |-
                              Email matches specific email addresses.
                              SDK: EmailRule
                            properties:
                              addresses:
                                description: Addresses to match.
                                items:
                                  type: string
                                maxItems: 50
                                minItems: 1
                                type: array
                            required:
                            - addresses
                            type: object
                          emailDomain:
                            description: |-
                              EmailDomain matches email domain suffix.
                              SDK: DomainRule
                            properties:
                              domain:
                                description: |-
                                  Domain suffix (e.g., "example.com").
                                  Max 253: RFC 1035 section 2.3.4 FQDN presentation-format limit.
                                maxLength: 253
                                minLength: 1
                                type: string
                            required:
                            - domain
                            type: object
                          emailList:
                            description: |-
                              EmailList references a Cloudflare Access email list.
                              SDK: EmailListRule
                            properties:
                              id:
                                description: ID of the Access list in Cloudflare.
                                maxLength: 36
                                type: string
                              name:
                                description: Name of the Access list (looked up via
                                  API).
                                maxLength: 255
                                type: string
                            type: object
                            x-kubernetes-validations:
                            - message: either id or name must be specified
                              rule: has(self.id) || has(self.name)
                          everyone:
                            description: |-
                              Everyone matches all users (use with caution).
                              SDK: EveryoneRule
                            type: boolean
                          gsuiteGroup:
                            description: |-
                              GSuiteGroup matches Google Workspace groups.
                              SDK: GSuiteGroupRule
                            properties:
                              email:
                                description: Email is the Google Workspace group email.
                                maxLength: 320
                                minLength: 1
                                type: string
                              identityProviderId:
                                description: IdentityProviderID in Cloudflare.
                                maxLength: 36
                                minLength: 1
                                type: string
                            required:
                            - email
                            - identityProviderId
                            type: object
                          ip:
                            description: |-
                              IP matches source IP CIDR ranges.
                              SDK: IPRule
                            properties:
                              ranges:
                                description: Ranges are CIDR blocks (IPv4 or IPv6).
                                items:
                                  type: string
                                maxItems: 50
                                minItems: 1
                                type: array
                            required:
                            - ranges
                            type: object
                          ipList:
                            description: |-
                              IPList references a Cloudflare IP List.
                              SDK: IPListRule
                            properties:
                              id:
                                description: ID of the IP list in Cloudflare.
                                maxLength: 36
                                type: string
                              name:
                                description: Name of the IP list (looked up via API).
                                maxLength: 255
                                type: string
                            type: object
                            x-kubernetes-validations:
                            - message: either id or name must be specified
                              rule: has(self.id) || has(self.name)
                          oidcClaim:
                            description: |-
                              OIDCClaim matches OIDC token claims.
                              SDK: AccessOIDCClaimRule
                            properties:
                              claimName:
                                description: ClaimName is the OIDC claim to match.
                                maxLength: 255
                                minLength: 1
                                type: string
                              claimValue:
                                description: ClaimValue is the expected value.
                                maxLength: 255
                                minLength: 1
                                type: string
                              identityProviderId:
                                description: IdentityProviderID in Cloudflare.
                                maxLength: 36
                                minLength: 1
                                type: string
                            required:
                            - claimName
                            - claimValue
                            - identityProviderId
                            type: object
                          serviceToken:
                            description: |-
                              ServiceToken matches a specific service token by ID.
                              SDK: ServiceTokenRule
                            properties:
                              tokenId:
                                description: TokenID is the Cloudflare service token
                                  ID.
                                maxLength: 36
                                minLength: 1
                                type: string
                            required:
                            - tokenId
                            type: object
                        type: object
                        x-kubernetes-validations:
                        - message: at least one rule type must be specified
                          rule: '[has(self.ip), has(self.ipList), has(self.country),
                            has(self.everyone), has(self.serviceToken), has(self.anyValidServiceToken),
                            has(self.email), has(self.emailList), has(self.emailDomain),
                            has(self.oidcClaim), has(self.gsuiteGroup)].exists(x,
                            x)'
                      maxItems: 25
                      type: array
                    sessionDuration:
                      description: SessionDuration overrides application session duration
                        for this rule.
                      maxLength: 10
                      pattern: ^[0-9]+(h|m|s)$
                      type: string
                  required:
                  - decision
                  - name
                  type: object
                  x-kubernetes-validations:
                  - message: include rules are required for allow and deny decisions
                    rule: self.decision in ['bypass', 'non_identity'] || size(self.include)
                      > 0
                maxItems: 50
                type: array
              serviceTokens:
                description: ServiceTokens for machine-to-machine authentication.
                items:
                  description: |-
                    ServiceTokenConfig defines configuration for Cloudflare Access service tokens.

                    ServiceTokenConfig enables machine-to-machine authentication. The controller creates
                    the service token in Cloudflare and stores the credentials (client ID and secret) in
                    the referenced Kubernetes Secret. The secret is only visible at creation time.
                  properties:
                    duration:
                      default: 8760h
                      description: |-
                        Duration is the token validity period using Go duration format.
                        Only hours (h) supported by Cloudflare API. Use "8760h" for 1 year.
                      pattern: ^[0-9]+h$
                      type: string
                    name:
                      description: Name is the token display name.
                      maxLength: 255
                      minLength: 1
                      type: string
                    secretRef:
                      description: SecretRef stores the generated token credentials.
                      properties:
                        name:
                          description: Name of the Secret.
                          maxLength: 253
                          minLength: 1
                          type: string
                      required:
                      - name
                      type: object
                  required:
                  - name
                  - secretRef
                  type: object
                maxItems: 10
                type: array
              targetRef:
                description: TargetRef identifies a single target for policy attachment.
                properties:
                  group:
                    default: gateway.networking.k8s.io
                    description: Group is the API group of the target resource.
                    type: string
                  kind:
                    description: Kind is the kind of the target resource.
                    enum:
                    - Gateway
                    - HTTPRoute
                    - GRPCRoute
                    - TCPRoute
                    - UDPRoute
                    type: string
                  name:
                    description: Name is the name of the target resource.
                    maxLength: 253
                    minLength: 1
                    type: string
                  namespace:
                    description: |-
                      Namespace is the namespace of the target resource.
                      Cross-namespace targeting requires ReferenceGrant.
                    type: string
                  sectionName:
                    description: SectionName targets specific listener (Gateway) or
                      rule (Route).
                    type: string
                required:
                - group
                - kind
                - name
                type: object
                x-kubernetes-validations:
                - message: group must be gateway.networking.k8s.io
                  rule: self.group == 'gateway.networking.k8s.io'
                - message: kind must be Gateway, HTTPRoute, GRPCRoute, TCPRoute, or
                    UDPRoute
                  rule: self.kind in ['Gateway', 'HTTPRoute', 'GRPCRoute', 'TCPRoute',
                    'UDPRoute']
              targetRefs:
                description: TargetRefs identifies multiple targets for policy attachment.
                items:
                  description: |-
                    PolicyTargetReference identifies a Gateway API resource for Access policy attachment.

                    PolicyTargetReference follows the Gateway API LocalPolicyTargetReferenceWithSectionName
                    pattern for policy attachment. It targets Gateway API resources (Gateway, HTTPRoute,
                    GRPCRoute, TCPRoute, UDPRoute) and extracts hostnames from those resources to create
                    corresponding Cloudflare Access applications.

                    Cross-namespace references require a ReferenceGrant in the target namespace that permits
                    CloudflareAccessPolicy resources from the policy's namespace.
                  properties:
                    group:
                      default: gateway.networking.k8s.io
                      description: Group is the API group of the target resource.
                      type: string
                    kind:
                      description: Kind is the kind of the target resource.
                      enum:
                      - Gateway
                      - HTTPRoute
                      - GRPCRoute
                      - TCPRoute
                      - UDPRoute
                      type: string
                    name:
                      description: Name is the name of the target resource.
                      maxLength: 253
                      minLength: 1
                      type: string
                    namespace:
                      description: |-
                        Namespace is the namespace of the target resource.
                        Cross-namespace targeting requires ReferenceGrant.
                      type: string
                    sectionName:
                      description: SectionName targets specific listener (Gateway)
                        or rule (Route).
                      type: string
                  required:
                  - group
                  - kind
                  - name
                  type: object
                  x-kubernetes-validations:
                  - message: group must be gateway.networking.k8s.io
                    rule: self.group == 'gateway.networking.k8s.io'
                  - message: kind must be Gateway, HTTPRoute, GRPCRoute, TCPRoute,
                      or UDPRoute
                    rule: self.kind in ['Gateway', 'HTTPRoute', 'GRPCRoute', 'TCPRoute',
                      'UDPRoute']
                maxItems: 16
                type: array
            required:
            - application
            type: object
            x-kubernetes-validations:
            - message: either targetRef or targetRefs must be specified
              rule: has(self.targetRef) || has(self.targetRefs)
            - message: targetRef and targetRefs are mutually exclusive
              rule: '!(has(self.targetRef) && has(self.targetRefs))'
          status:
            description: |-
              CloudflareAccessPolicyStatus defines the observed state of a CloudflareAccessPolicy resource.

              CloudflareAccessPolicyStatus captures the Cloudflare-assigned identifiers for the
              Access Application and policies, service token mappings, and per-target attachment status.
            properties:
              ancestors:
                description: Ancestors contains status for each targetRef (Gateway
                  API PolicyStatus).
                items:
                  description: |-
                    PolicyAncestorStatus describes the policy attachment status for a specific target.

                    PolicyAncestorStatus follows the Gateway API PolicyAncestorStatus pattern to report
                    per-target attachment status. Each target reference in the spec has a corresponding
                    ancestor status entry showing whether the policy was successfully attached.
                  properties:
                    ancestorRef:
                      description: AncestorRef identifies the target.
                      properties:
                        group:
                          default: gateway.networking.k8s.io
                          description: Group is the API group of the target resource.
                          type: string
                        kind:
                          description: Kind is the kind of the target resource.
                          enum:
                          - Gateway
                          - HTTPRoute
                          - GRPCRoute
                          - TCPRoute
                          - UDPRoute
                          type: string
                        name:
                          description: Name is the name of the target resource.
                          maxLength: 253
                          minLength: 1
                          type: string
                        namespace:
                          description: |-
                            Namespace is the namespace of the target resource.
                            Cross-namespace targeting requires ReferenceGrant.
                          type: string
                        sectionName:
                          description: SectionName targets specific listener (Gateway)
                            or rule (Route).
                          type: string
                      required:
                      - group
                      - kind
                      - name
                      type: object
                      x-kubernetes-validations:
                      - message: group must be gateway.networking.k8s.io
                        rule: self.group == 'gateway.networking.k8s.io'
                      - message: kind must be Gateway, HTTPRoute, GRPCRoute, TCPRoute,
                          or UDPRoute
                        rule: self.kind in ['Gateway', 'HTTPRoute', 'GRPCRoute', 'TCPRoute',
                          'UDPRoute']
                    conditions:
                      description: Conditions for this specific target.
                      items:
                        description: Condition contains details for one aspect of
                          the current state of this API Resource.
                        properties:
                          lastTransitionTime:
                            description: |-
                              lastTransitionTime is the last time the condition transitioned from one status to another.
                              This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                            format: date-time
                            type: string
                          message:
                            description: |-
                              message is a human readable message indicating details about the transition.
                              This may be an empty string.
                            maxLength: 32768
                            type: string
                          observedGeneration:
                            description: |-
                              observedGeneration represents the .metadata.generation that the condition was set based upon.
                              For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                              with respect to the current state of the instance.
                            format: int64
                            minimum: 0
                            type: integer
                          reason:
                            description: |-
                              reason contains a programmatic identifier indicating the reason for the condition's last transition.
                              Producers of specific condition types may define expected values and meanings for this field,
                              and whether the values are considered a guaranteed API.
                              The value should be a CamelCase string.
                              This field may not be empty.
                            maxLength: 1024
                            minLength: 1
                            pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                            type: string
                          status:
                            description: status of the condition, one of True, False,
                              Unknown.
                            enum:
                            - "True"
                            - "False"
                            - Unknown
                            type: string
                          type:
                            description: type of condition in CamelCase or in foo.example.com/CamelCase.
                            maxLength: 316
                            pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                            type: string
                        required:
                        - lastTransitionTime
                        - message
                        - reason
                        - status
                        - type
                        type: object
                      type: array
                    controllerName:
                      description: ControllerName identifies the controller managing
                        this attachment.
                      type: string
                  required:
                  - ancestorRef
                  - controllerName
                  type: object
                type: array
              applicationAud:
                description: ApplicationAUD is the Application Audience Tag.
                type: string
              applicationId:
                description: ApplicationID is the Cloudflare Access Application ID.
                type: string
              attachedTargets:
                description: AttachedTargets is the count of successfully attached
                  targets.
                format: int32
                type: integer
              conditions:
                description: Conditions describe current state.
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
                x-kubernetes-list-map-keys:
                - type
                x-kubernetes-list-type: map
              mtlsRuleId:
                description: MTLSRuleID is the Cloudflare mTLS rule ID.
                type: string
              observedGeneration:
                description: ObservedGeneration is the last generation processed.
                format: int64
                type: integer
              serviceTokenIds:
                additionalProperties:
                  type: string
                description: ServiceTokenIDs maps token names to Cloudflare IDs.
                type: object
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
{{- end }}
